# üåç VisitMap

> Desenvolvido por: Lais Alves da S Cruz - RM552258 üë©üèª‚Äçüíª

**VisitMap** √© uma aplica√ß√£o desenvolvida em Spring Boot e Thymeleaf que permite aos usu√°rios planejar e explorar roteiros tur√≠sticos de forma f√°cil e interativa. A aplica√ß√£o oferece uma interface amig√°vel para visualizar locais tur√≠sticos, suas informa√ß√µes e criar itiner√°rios personalizados.

## üìö Estrutura do Banco de Dados

A aplica√ß√£o utiliza um modelo de banco de dados relacional para gerenciar as informa√ß√µes dos locais tur√≠sticos, itiner√°rios e suas intera√ß√µes. Abaixo est√° o diagrama de Entidade e Relacionamento com as tabelas principais da estrutura do banco de dados:

```mermaid
erDiagram
    PLACE {
        Long id PK "Identificador √∫nico"
        String nome "Nome da atra√ß√£o"
        String descricao "Descri√ß√£o da atra√ß√£o"
        String cidade "Cidade onde a atra√ß√£o est√° localizada"
        String estado "Estado onde a atra√ß√£o est√° localizada"
        String rua "Rua onde a atra√ß√£o est√° localizada"
        String tipo "Tipo da atra√ß√£o (enum)"
        String description "Descri√ß√£o adicional"
        String entrada "Tipo de entrada (enum)"
        String urlImagem "URL da imagem da atra√ß√£o"
    }

    ITINERARY {
        Long id PK "Identificador √∫nico"
        String nome "Nome do itiner√°rio"
        LocalDate data_criacao "Data de cria√ß√£o do itiner√°rio"
        String pais "Pa√≠s do itiner√°rio (enum)"
    }

    ITINERARY_PLACE {
        Long itinerary_id FK "Refer√™ncia ao itiner√°rio"
        Long place_id FK "Refer√™ncia ao local"
    }

    PLACE ||--o{ ITINERARY_PLACE : "√© inclu√≠do em"
    ITINERARY ||--o{ ITINERARY_PLACE : "inclui"
```

---

## üõ§Ô∏è Rotas da Aplica√ß√£o

### üè† Home (`index.html`)
- **P√°gina Inicial**: `GET /`  
  Acesso √† p√°gina inicial do VisitMap.

### üó∫Ô∏è Itiner√°rios (`/itineraries`)
- **Listar Itiner√°rios**: `GET /itineraries`  
- **Detalhes do Itiner√°rio**: `GET /itineraries/{id}`  
- **Criar Novo Itiner√°rio**: `GET /itineraries/new`  
- **Salvar Itiner√°rio**: `POST /itineraries`  
- **Editar Itiner√°rio**: `GET /itineraries/edit/{id}`  
- **Atualizar Itiner√°rio**: `POST /itineraries/{id}`  
- **Deletar Itiner√°rio**: `GET /itineraries/delete/{id}`  

### üèõÔ∏è Lugares Turisticos (`/places`)
- **Listar Lugares**: `GET /places`  
- **Detalhes do Lugar**: `GET /places/{id}`  
- **Criar Novo Lugar**: `GET /places/new`  
- **Salvar Lugar**: `POST /places`  
- **Editar Lugar**: `GET /places/edit/{id}`  
- **Atualizar Lugar**: `POST /places/{id}`  
- **Deletar Lugar**: `GET /places/delete/{id}`  

---

## üß™ Testes Unit√°rios

A aplica√ß√£o **VisitMap** inclui uma su√≠te de testes unit√°rios que garante a qualidade e o funcionamento adequado dos servi√ßos. Foram implementados testes para as classes `ItineraryService` e `PlaceService` utilizando **JUnit** e **Mockito**. 

No total, 12 testes foram executados com sucesso, confirmando que as funcionalidades principais est√£o funcionando conforme o esperado.

![Terminal com comando `mvn clean test`](https://github.com/user-attachments/assets/f03da1d2-d8c9-4a78-bec9-4cc4b63b6a80)

---

## CRUD - Exemplos üìã

### 1. Criar üé§

#### *Lugar Tur√≠stico* üèõÔ∏è

Para criar um novo Lugar Tur√≠stico, voc√™ deve enviar um formul√°rio com as seguintes informa√ß√µes:

```plaintext
Nome: Museu de Arte Moderna
Cidade: S√£o Paulo
Estado: S√£o Paulo
Descri√ß√£o: Um museu que exibe obras de arte moderna e contempor√¢nea.
Tipo: MUSEU
Entrada: PAGO
Rua: Avenida Paulista, 1234
URL da Imagem: https://abrir.link/BMdUO
```

#### *Itiner√°rio* ‚úàÔ∏è

Para criar um novo Itiner√°rio, voc√™ pode usar o seguinte formul√°rio:

```plaintext
Nome: Paulistano por um Dia
Pa√≠s: BRASIL
(Selecione os Lugares)
```

### 2. Ler üìñ

#### *Lugar Tur√≠stico* üîç

Para ler os detalhes de um lugar espec√≠fico, aperte em 'Detalhes'.

#### *Itiner√°rio* üìÖ

Para ler os detalhes de um Itiner√°rio espec√≠fico, aperte em 'Detalhes'.

### 3. Atualizar ‚úèÔ∏è

#### *Lugar Tur√≠stico* üèõÔ∏è

Para atualizar as informa√ß√µes de um lugar existente, voc√™ pode enviar o seguinte formul√°rio:

```plaintext
Nome: MASP
Cidade: S√£o Paulo
Estado: S√£o Paulo
Descri√ß√£o: O MASP √© famoso por sua arquitetura √∫nica e cole√ß√£o de arte moderna, contempor√¢nea e cl√°ssica.
Tipo: MUSEU
Entrada: PAGO
Rua: Av Paulista, 1234
URL da Imagem: https://abrir.link/BMdUO
```

#### *Itiner√°rio* üåü

Para atualizar um itiner√°rio existente, voc√™ pode usar o seguinte formul√°rio:

```plaintext
Nome: S√£o Paulo Cultural
(Selecione os Lugares )
```

### 4. Excluir üóëÔ∏è

#### *Lugar Tur√≠stico* ‚ùå

Para excluir um lugar, aperte em 'Excluir'.

#### *Itiner√°rio* ‚ùå

Para excluir um itiner√°rio, aperte em 'Excluir'.

---
## üê≥ Dockerfile Utilizado

A configura√ß√£o do `Dockerfile` √© essencial para preparar o ambiente de execu√ß√£o da aplica√ß√£o, garantindo que todos os componentes necess√°rios sejam inclu√≠dos na imagem Docker e que a aplica√ß√£o seja executada de forma segura. Abaixo est√£o os detalhes de cada etapa do `Dockerfile` utilizado para o VisitMap:

```Dockerfile
# Use a imagem base do OpenJDK 17 com suporte ao Alpine Linux
FROM eclipse-temurin:17-jdk-alpine

# Instale o Maven para gerenciar depend√™ncias e compilar o projeto
RUN apk add --no-cache maven

# Defina o diret√≥rio de trabalho para a aplica√ß√£o
WORKDIR /app

# Copie o arquivo de configura√ß√£o do Maven para o diret√≥rio de trabalho
COPY pom.xml .

# Copie o c√≥digo-fonte da aplica√ß√£o para o diret√≥rio de trabalho
COPY src ./src

# Compile a aplica√ß√£o com o Maven e gere o arquivo JAR
RUN mvn clean package

# Crie um usu√°rio n√£o privilegiado para executar a aplica√ß√£o com seguran√ßa
RUN adduser -D appuser

# Altere a propriedade do arquivo JAR gerado para o usu√°rio n√£o privilegiado
RUN chown appuser:appuser target/VisitMap-0.0.1-SNAPSHOT.jar

# Altere para o usu√°rio n√£o privilegiado para evitar execu√ß√£o como root
USER appuser

# Exponha a porta 8080 para acesso √† aplica√ß√£o
EXPOSE 8080

# Defina o comando de entrada para iniciar a aplica√ß√£o usando o JAR gerado
CMD ["java", "-jar", "target/VisitMap-0.0.1-SNAPSHOT.jar"]
```
---

## üöÄ Deploy e Integra√ß√£o Cont√≠nua - Azure Pipelines

O **VisitMap** utiliza uma abordagem automatizada para implanta√ß√£o e entrega cont√≠nua, aproveitando os recursos do **Azure Container Registry (ACR)** e do **Azure Container Instances (ACI)**. O pipeline de CI/CD √© configurado para garantir que o processo de build, teste e deploy seja cont√≠nuo e integrado ao fluxo de desenvolvimento. üåêüîß

### Passo a Passo para Configura√ß√£o do CI/CD

1. **Cria√ß√£o do Repos do Azure DevOps** ‚òÅÔ∏è
   - Primeiramente, configure uma conta no **Azure DevOps** e crie um novo projeto para o **VisitMap**.
   - Importe o reposit√≥rio do GitHub e crie as tasks necess√°rias para o pipeline.

2. **Cria√ß√£o da Infraestrutura no Azure** ‚òÅÔ∏è
   - Inicie configurando uma conta no **Azure Cloud**.
   - Utilize o **Azure CLI** para automatizar a cria√ß√£o da infraestrutura necess√°ria para o seu projeto, garantindo que todos os recursos sejam provisionados de forma eficiente e padronizada.
   - Adicione uma conex√£o de servi√ßo com o **Azure Container Registry (ACR)** e o **Azure Container Instances (ACI)**, que ser√£o utilizados para hospedar a aplica√ß√£o.

3. **Configura√ß√£o do Pipeline de Build (CI)** üõ†Ô∏è
   - Crie um pipeline de build no **Azure Pipelines** para o reposit√≥rio do projeto.
   - Use o arquivo YAML gerado a seguir para configurar o pipeline de build:

```yaml
# azure-pipelines.yml
trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
- task: Maven@4
  inputs:
    azureSubscription: '$(AzureSubscriptionID)'
    mavenPomFile: 'pom.xml'
    goals: 'clean package'
    options: '-DskipTests=false'
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.17'
    mavenVersionOption: 'Default'
    mavenAuthenticateFeed: false
    effectivePomSkip: false
    sonarQubeRunAnalysis: false
- task: Docker@2
  inputs:
    containerRegistry: 'visitmaprm552258'
    repository: 'visitmap'
    command: 'buildAndPush'
    Dockerfile: '**/Dockerfile'
    tags: |
      $(Build.BuildId)
      latest
```

   - Esse pipeline executa os testes unit√°rios com **JUnit**, constr√≥i o pacote da aplica√ß√£o e gera uma imagem Docker, que √© enviada ao **Azure Container Registry**. üê≥ O **ACR** permite armazenar e gerenciar essas imagens de forma segura.
> [!IMPORTANT]  
> **Nota: A vari√°vel `$(AzureSubscriptionID)` representa o identificador da assinatura do Azure, que √© utilizado para autentica√ß√£o e acesso seguro aos recursos da conta no Azure.** 


4. **Configura√ß√£o do Pipeline de Release (CD)** üö¢
   - **Cria√ß√£o do Pipeline de Release**: Configure um pipeline de release no Azure DevOps para automatizar a implanta√ß√£o da aplica√ß√£o.
   - **Integra√ß√£o com o Pipeline de Build**: Utilize o artefato gerado pelo pipeline de build como fonte para garantir que a vers√£o mais recente seja implantada.
   - **Est√°gio de Deploy com ACI**: Defina est√°gios de deploy usando **Azure Container Instances (ACI)** como o ambiente de produ√ß√£o, permitindo implanta√ß√µes escal√°veis e seguras.
   - **Aprova√ß√µes e Gates**: Caso necess√°rio, implemente revis√µes e aprova√ß√µes antes de implanta√ß√µes em produ√ß√£o para aumentar a seguran√ßa e confiabilidade. 

5. **Teste do Deploy Manual** üß™
   - Realize um teste inicial do pipeline de release criando uma nova release manualmente.
   - Verifique se a aplica√ß√£o √© implantada corretamente e se todos os servi√ßos est√£o funcionando como esperado. 
     
---

## Tecnologias Utilizadas üõ†Ô∏è

- **Spring Boot**: Framework para desenvolvimento de aplica√ß√µes Java.
- **Thymeleaf**: Motor de templates para gerar p√°ginas HTML din√¢micas.
- **Hibernate**: ORM para mapeamento objeto-relacional.
- **Oracle Database**: Banco de dados relacional utilizado para armazenar informa√ß√µes de itiner√°rios e atra√ß√µes tur√≠sticas.
- **JUnit**: Framework para testes unit√°rios em Java.
- **Maven**: Ferramenta de gerenciamento de depend√™ncias e build do projeto.
- **Azure CLI**: Utilizada para criar e gerenciar Azure Container Registry (ACR) e Azure Container Instances (ACI).
- **Azure DevOps**: Para configura√ß√£o de pipelines de CI/CD.
- **Docker**: Utilizado para containeriza√ß√£o da aplica√ß√£o.

---

> Esse guia detalha o processo de configura√ß√£o do CI/CD, desde a cria√ß√£o do projeto no Azure at√© a configura√ß√£o do pipeline de build e release, facilitando a automa√ß√£o do deploy e a entrega cont√≠nua da aplica√ß√£o VisitMap. ‚ú®üöÄ
